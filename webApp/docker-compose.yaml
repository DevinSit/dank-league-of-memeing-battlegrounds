version: '2'

services:
    # frontend:
    #     build:
    #         context: ./frontend
    #         args:
    #             app_env: dev
    #     image: frontend
    #     ports:
    #         - "3000:3000"
    #     volumes:
    #         - ./frontend:/frontend
    #         - frontend-deps:/frontend/node_modules
    redesign:
        build:
            context: ./redesign
            args:
                app_env: development
        image: redesign
        ports:
            - "3001:3000"
        volumes:
            - ./redesign:/redesign
            - redesign-deps:/redesign/node_modules
    backend:
        build: ./backend
        image: backend
        ports:
            - "5000:5000"
        command: python src/main.py
        volumes:
            - ./backend/:/app
            - ./models/:/var/model-storage
            - ./:/gcp
        environment:
            - GOOGLE_APPLICATION_CREDENTIALS=/gcp/easy-dank-meme-classifier-account.json
            # - DATASTORE_EMULATOR_HOST=datastore:8081
            # - DATASTORE_PROJECT_ID=serverless-hackathon-devin
            - FLASK_ENV=development
    # datastore:
    #     image: singularities/datastore-emulator
    #     environment:
    #         - DATASTORE_PROJECT_ID=serverless-hackathon-devin
    #         - DATASTORE_LISTEN_ADDRESS=0.0.0.0:8081
    #     ports:
    #         - "8081:8081"

volumes:
    frontend-deps:
    redesign-deps:
